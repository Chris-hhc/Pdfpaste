# PDF页面选择器

一个功能强大的PDF页面选择和批量处理工具，支持页面预览、缩放、选择和自动复制粘贴功能。

## 功能特性

- 📄 PDF文档加载和预览
- 🔍 多级缩放支持（50%-500%）
- 📋 页面选择和批量处理
- 🖼️ 页面转图片功能
- ⚡ 全局快捷键自动复制粘贴
- 📁 临时文件管理
- 🎨 现代化UI界面

## 项目结构

```
auto_pdf_py/
├── main.py                 # 主入口文件
├── models/                 # 数据模型层
│   ├── __init__.py
│   └── pdf_model.py       # PDF文档模型和数据处理
├── services/              # 服务层
│   ├── __init__.py
│   ├── clipboard_service.py    # 剪贴板操作服务
│   ├── keyboard_service.py     # 键盘监听服务
│   └── auto_copy_service.py    # 自动复制粘贴服务
├── ui/                    # 用户界面层
│   ├── __init__.py
│   ├── main_window.py     # 主窗口
│   ├── control_panel.py   # 左侧控制面板
│   └── pdf_display.py     # PDF显示区域
├── pdf_viewer.py          # 原始文件（已重构）
└── README.md              # 项目说明
```

## 架构设计

### 分层架构

1. **UI层 (ui/)**
   - 负责用户界面展示和交互
   - 组件化设计，便于维护和扩展
   - 信号槽机制实现组件间通信

2. **服务层 (services/)**
   - 封装具体的业务逻辑
   - 提供可复用的服务接口
   - 独立于UI，便于测试

3. **模型层 (models/)**
   - 数据模型和业务实体
   - PDF文档处理逻辑
   - 数据持久化管理

### 主要组件

#### MainWindow (ui/main_window.py)
- 应用程序主窗口
- 协调各个组件的交互
- 处理全局事件和生命周期

#### ControlPanel (ui/control_panel.py)
- 左侧控制面板
- 文件选择、页面选择、临时文件管理
- 时间间隔设置

#### PDFDisplay (ui/pdf_display.py)
- PDF页面显示区域
- 缩放控制和页面预览
- 页面选择交互

#### PDFDocument (models/pdf_model.py)
- PDF文档数据模型
- 页面处理和图片转换
- 临时文件管理

#### Services (services/)
- **ClipboardService**: 剪贴板操作
- **KeyboardService**: 全局快捷键监听
- **AutoCopyService**: 自动复制粘贴流程

## 快捷键

- `Command+O`: 打开PDF文件 (窗口内)
- `Command+S`: 选择页面 (窗口内)
- `Option+Command`: 自动遍历复制粘贴图片 (全局)

## 运行方式

```bash
# 使用新的模块化结构
python main.py

# 或者继续使用原始文件
python pdf_viewer.py
```

## 依赖要求

- Python 3.7+
- PyQt5
- PyMuPDF (fitz)
- AppKit (macOS)
- Quartz (macOS)

## 重构优势

1. **代码组织**: 清晰的分层结构，职责分离
2. **可维护性**: 模块化设计，便于修改和扩展
3. **可测试性**: 服务层独立，便于单元测试
4. **可复用性**: 组件化UI，服务可复用
5. **可扩展性**: 新功能可以独立开发和集成

## 开发指南

### 添加新功能

1. **UI功能**: 在对应的UI组件中添加
2. **业务逻辑**: 在services层创建新服务
3. **数据处理**: 在models层扩展数据模型
4. **集成**: 在MainWindow中协调新功能

### 修改现有功能

1. 确定功能所在的层次
2. 修改对应的模块
3. 更新相关的信号连接
4. 测试功能完整性

这种架构设计使得代码更加清晰、可维护，并为未来的功能扩展提供了良好的基础。

## 安装说明

### 1. 安装Python依赖

```bash
pip install -r requirements.txt
```

### 2. 运行应用程序

```bash
python pdf_viewer.py
```

## 使用方法

### 基本操作流程

1. **打开PDF文件**
   - 点击"选择PDF文件"按钮或使用快捷键 `Cmd+O`
   - 等待PDF加载完成（会显示进度条）

2. **选择页面**
   - 在"页码范围"输入框中输入要选择的页码
   - 支持格式：`1,3,5-7,10`（逗号分隔，连字符表示范围）
   - 点击"选择页面"按钮或使用快捷键 `Cmd+S`

3. **复制到剪贴板**
   - 点击"复制选中页面到剪贴板"按钮或使用快捷键 `Cmd+C`
   - 第一页会自动复制到系统剪贴板

4. **AI聊天辅助**
   - 使用 `Cmd+Left/Right` 在剪贴板页面间导航
   - 使用 `Cmd+A` 复制当前页面到系统剪贴板
   - 在AI网页聊天界面中粘贴图片

### 快捷键一览

| 快捷键 | 功能 |
|--------|------|
| `Cmd+O` | 打开PDF文件 |
| `Cmd+S` | 选择页面 |
| `Cmd+C` | 复制到剪贴板 |
| `Cmd+Left` | 上一页 |
| `Cmd+Right` | 下一页 |
| `Cmd+A` | 复制当前页面 |

### 页码输入格式

- **单页**: `5` - 选择第5页
- **多页**: `1,3,7` - 选择第1、3、7页
- **范围**: `3-8` - 选择第3到8页
- **混合**: `1,3,5-7,10` - 选择第1、3、5、6、7、10页

## 工作流程示例

### 向AI大模型提交PDF页面

1. 打开要分析的PDF文档
2. 选择需要AI分析的页面（如：`1-5,10,15-20`）
3. 复制页面到剪贴板
4. 打开AI大模型网页（如ChatGPT、Claude等）
5. 开始新对话，输入问题描述
6. 使用 `Cmd+A` 将第一页图片复制到剪贴板
7. 在AI聊天框中粘贴图片
8. 继续使用 `Cmd+Right` 和 `Cmd+A` 逐个添加其他页面
9. 发送消息给AI进行分析

## 技术规格

- **UI框架**: PyQt5 (更稳定的macOS支持)
- **PDF处理**: PyMuPDF (fitz)
- **图像处理**: Pillow (PIL)
- **剪贴板**: 原生macOS AppleScript
- **平台支持**: macOS

## 注意事项

⚠️ **macOS专用**: 剪贴板功能使用macOS原生AppleScript，仅支持macOS系统  
⚠️ **内存使用**: 大型PDF文件可能占用较多内存  
⚠️ **图片质量**: 默认使用2x缩放以保证图片清晰度  

## 故障排除

### 常见问题

**Q: PDF加载失败**  
A: 检查PDF文件是否损坏，尝试使用其他PDF文件

**Q: 剪贴板复制失败**  
A: 确保在macOS系统上运行，检查系统权限设置

**Q: 页面显示模糊**  
A: 调整代码中的缩放比例（Matrix参数）

**Q: 快捷键不工作**  
A: 确保应用程序窗口处于活动状态

## 开发说明

### 项目结构
```
auto_pdf_py/
├── pdf_viewer.py      # 主应用程序
├── requirements.txt   # Python依赖
└── README.md         # 使用说明
```

### 扩展建议

- 添加PDF编辑功能
- 支持其他平台剪贴板
- 添加OCR文字识别
- 支持批量处理
- 添加页面注释功能

## 许可证

本项目为开源项目，可自由使用和修改。 